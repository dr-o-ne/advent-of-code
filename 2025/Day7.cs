namespace AdventOfCode._2025;

public sealed class Day7
{
    public object Solve1(string input) => Solve(input).splits;

    public object Solve2(string input) => Solve(input).timelines;

    private static (long splits, long timelines) Solve(string input)
    {
        int splits = 0;

        char[,] matrix = Parse(input);
        int rows = matrix.GetLength(0);
        int columns = matrix.GetLength(1);

        long[] timelines = new long[columns];
        for (int x = 0; x < columns; x++)
            timelines[x] = matrix[0, x] == '|' ? 1 : 0;

        for (int y = 1; y < rows; y++)
        {
            for (int x = 0; x < columns; x++)
            {
                if (matrix[y - 1, x] != '|')
                    continue;

                switch(matrix[y, x])
                {
                    case '.':
                        matrix[y, x] = '|';
                        continue;
                    case '^':
                        if (x > 0)
                        {
                            matrix[y, x - 1] = '|';
                            timelines[x - 1] += timelines[x];
                        }
                        if (x < columns - 1)
                        {
                            matrix[y, x + 1] = '|';
                            timelines[x + 1] += timelines[x];
                        }

                        timelines[x] = 0;
                        splits++;
                        break;
                    default:
                        break;
                }
            }
        }

        return (splits, timelines.Sum());
    }

    private static char[,] Parse(string input) =>
        Utils.ParseMatrix<char>(input.Replace("S", "|"));

    [Fact]
    public void Test1() => Assert.Equal(21L, Solve1(TestInput));

    [Fact]
    public void Test2() => Assert.Equal(1600L, Solve1(Input));

    [Fact]
    public void Test3() => Assert.Equal(40L, Solve2(TestInput));

    [Fact]
    public void Test4() => Assert.Equal(8632253783011L, Solve2(Input));

    private const string TestInput = @".......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............";

    private const string Input = @"......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^.^...^...................................................................
.............................................................................................................................................
..................................................................^...^.^.^..................................................................
.............................................................................................................................................
.................................................................^.^...^.^.^.................................................................
.............................................................................................................................................
................................................................^...^.^.^.^.^................................................................
.............................................................................................................................................
...............................................................^.............^...............................................................
.............................................................................................................................................
..............................................................^...^.^.^...^.^.^..............................................................
.............................................................................................................................................
.............................................................^.^.^...^.....^.^.^.............................................................
.............................................................................................................................................
............................................................^...^.^.^...^.^...^.^............................................................
.............................................................................................................................................
...........................................................^.^...^.^...^.^.^...^.^...........................................................
.............................................................................................................................................
..........................................................^.^.^.^...^...^...^.....^..........................................................
.............................................................................................................................................
.........................................................^.^.^.....^.^.^.^...^.....^.........................................................
.............................................................................................................................................
........................................................^.^.^.^.^.......^...^.^.^...^........................................................
.............................................................................................................................................
.......................................................^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.......................................................
.............................................................................................................................................
......................................................^.....^...^.^.^...........^...^.^......................................................
.............................................................................................................................................
.....................................................^...^.^.^.^...^.....^.^.^...^...^.^.....................................................
.............................................................................................................................................
....................................................^.....^.^.^.^.....^.^.^.^.^.^...^.^.^....................................................
.............................................................................................................................................
...................................................^...^.^.^.^.^.^.^...^.^.^.^...^.^.^.^.^...................................................
.............................................................................................................................................
..................................................^.^.^.^.^...^.^...^.^...^.^.^.^.^.^...^.^..................................................
.............................................................................................................................................
.................................................^...^.....^...^.^.^.^...^.....^.^...^.^...^.................................................
.............................................................................................................................................
................................................^.^.^.....^.^.^.^.....^.^.^.^...^.....^.^.^.^................................................
.............................................................................................................................................
...............................................^.....^.......^.....^...^.^...^.^.^...^.......^...............................................
.............................................................................................................................................
..............................................^.^...^...^.^...^...^...^.^...^.^.^.^...^...^.^.^..............................................
.............................................................................................................................................
.............................................^...^...^.^.........^.^...^.^.....^.^.^.^.^.^...^.^.............................................
.............................................................................................................................................
............................................^.^.^...^.^.^.^.^...^.^.^...^.^...^.^...^.^.^.^.^.^.^............................................
.............................................................................................................................................
...........................................^.....^.........^.^.^.^.^.^.^...^.^.^...^.^.^.^...^...^...........................................
.............................................................................................................................................
..........................................^.^.^.....^.......^.^...^.^.^.^.^.^.....^...^.^.^.^.^...^..........................................
.............................................................................................................................................
.........................................^.^.^.^.^...^.^.....^.....^.^.^.^.^.^.^...^...^.^.^.^.^.^.^.........................................
.............................................................................................................................................
........................................^.^.^...^...^.^.^.^.^.^.^.^...^...^...^.^...^.^...^...^.....^........................................
.............................................................................................................................................
.......................................^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.....^.^.^.^.^.^.^.........^.^.......................................
.............................................................................................................................................
......................................^.^.^.^.^.^.^.^.^.^.^...^.....^.......^.^.^.^.^.^.^.^...^...^...^......................................
.............................................................................................................................................
.....................................^.^.^.^.^...^...^.^.......^...^.^.....^...^.^.^.^.^.....^.^.^.^.^.^.....................................
.............................................................................................................................................
....................................^.....^.^...^...^.^.^.^.^.^...^.^.^...^.^.^.^.....^...^.^.^.^.^.^...^....................................
.............................................................................................................................................
...................................^.....^.^.........^...^.^.^.^.^.^.^...^.^.^...^.^.^.^.^...^.^...^.^...^...................................
.............................................................................................................................................
..................................^.^.^.^...^.^.^.^.^...^.^...^.^.^.^.^.....^.^.^.^.^.....^...^.....^.^.^.^..................................
.............................................................................................................................................
.................................^.^.........^...^.....^.^...^.^...^.^.^...^.^...^...^.^...^.^.^.^.^.....^.^.................................
.............................................................................................................................................
................................^.^...^.^.^.^.^...^...^...............^.....^.....^.^.^.^.^.^.^.^.^.^.....^.^................................
.............................................................................................................................................
...............................^.^.^...^.^...^.^.^...^...^.^.....^.^.^...^.^.^.^...^.^.^.^.^.^.^.^.^...^.^.^.^...............................
.............................................................................................................................................
..............................^...^.^.^.^.^.^.....^.^.^.^.....^.......^.^.^.^.^...^.^.^.^...^...^...^.^.^.....^..............................
.............................................................................................................................................
.............................^.^.^...^.^.^.^.^.^...^...^.^.^.^.^.^...^.^.^.^.^.......^.^.^.^...^.^.^.^...^.^...^.............................
.............................................................................................................................................
............................^.....^.^...^.^...^.^.....^.^...^.......^...^.^.....^...^.^...^...^.^.^.....^.^.....^............................
.............................................................................................................................................
...........................^...^...^...^.^.......^.....^.^.....^.^.^.^.^...^.^.^.^.....^.^.^...^.^.^.....^...^...^...........................
.............................................................................................................................................
..........................^.....^.^.^.......^.^...^.^.^.^.^.^.^.^.^.^.....^.....^.^...^.^...^.^.^...^...^.^.^.^...^..........................
.............................................................................................................................................
.........................^.^.^.^.^.^.^.^.^.^...^.....^.^...^.^.^.^.^.^.^.^.^...^.^.^.^.^.^...^.^.^...^.^...^.^.^.^.^.........................
.............................................................................................................................................
........................^.^.^...^.^.^...^.^...^.........^.^.^...^.^.^.^.....^.^...^.^.^.^.^...^.^.^...^.^.....^.....^........................
.............................................................................................................................................
.......................^.^.^.^...^.^.....^...^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.....^.......^.^.^.^...^.^...^.......................
.............................................................................................................................................
......................^.^...^.^.^.^.....^.^.^.^.^.....^.^...^.^.^.^.^.^.^...^...^.^.^.^...^.....^.^...^.^.^.^.^.^.^.^.^......................
.............................................................................................................................................
.....................^.^.^.^.^...^.^...^...^.^...^.^...^.^...^.......^.^.^.^.....^.^...^.^.^.^...^.^.^.^.^.^.^.^...^.^.^.....................
.............................................................................................................................................
....................^...^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^...^...^.^.^.^.......^...^.....^.^...^...^.^.....^.^.^...^.^.^....................
.............................................................................................................................................
...................^.^.^.^.^.^.......^.^.^.......^...^.^.^.^...^.^.^...^.^.^.^...^.^.^.^.....^.^.^.^.^.^...^.^...^.....^.^...................
.............................................................................................................................................
..................^.^...^.......^.^.^.^.....^.^...^.^...^...^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^...^.^...^.^.^.^.^...^.^.^...^..................
.............................................................................................................................................
.................^.....^.^...^...^.^.^.^...^.^.^.^...^.......^.^...^...^.^.^.....^.^.^...^.^...^.....^.^...^.^.^.^.^.^.^.^.^.................
.............................................................................................................................................
................^.^.^.....^.^.^.^.^.^.^.......^.^.^.....^...^.^...^.^.^.^.^...^.^...^.^.^...^...^.^.^.^...^.^.^.^...^.^.....^................
.............................................................................................................................................
...............^...^.^.^.^.^.^...^.^...^...^.^.^.^.^.^.^...^...^.^...............^...^.^.^.^.....^.....^.^.^.^.....^.^...^.^.^...............
.............................................................................................................................................
..............^.^...^.^.^.........^.........^...^.^.^.....^.^...^.^.^.^.^.^...^...^.^...^.^.^.^.......^.^...^.....^.^.^.^.^.^.^..............
.............................................................................................................................................
.............^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^...^.^.^.^.....^.^.^.^...^.^.^.^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.............
.............................................................................................................................................
............^.^.^.^...^.^.^.^.^...^...^.....^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^.^...^.^.^...^...^.....^.^...^.^.^.^.^.......^...^............
.............................................................................................................................................
...........^.....^.^.^.^.....^.^...^.^.^.^.^.....^.^.^...^.^.^...^.^.....^.......^.^.^.....^.^.^.^...^.^.^.^.^.^.^.^.^.^...^...^.^...........
.............................................................................................................................................
..........^.^.^.^.........^.^.....^.......^.^...^.^.^.......^.......^.^.^.^.....^.^...^.^...^.^.^.^...^...^.^.^.^.^.^.^...^.^.^.^.^..........
.............................................................................................................................................
.........^.^.^...^.^.........^...^.^...^.^.^.^.^.^.^.^.....^.^.^.^...^.^.^...^...^...^.^.^.^.^.^.^.^.^.^.^...^.^...^.^...^.^.^...^.^.........
.............................................................................................................................................
........^.^.^.^.^...^.^...^.^.^.^...^.^.^.^.^.....^...^...^.^...^.^...^.^.^.^...^...^.^...^.......^.^.^.^...^.....^...^.^.^.....^.^.^........
.............................................................................................................................................
.......^.^.^...^.^.^.....^.^.^.^.....^.....^.^...^.^.^.....^.^...^...........^...^.^.^.^.....^...^.^.^...^.^.^.^.......^.^.^.^.^.....^.......
.............................................................................................................................................
......^.^...^.....^.^...^.....^...^...^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^...^.^.^...^.^.^.^.^.^.^.^...^.....^.^.....^.^.^.^.^...^...^.^......
.............................................................................................................................................
.....^.^.^.^.^.^...^.^.......^.^.^...^...^.^.^.^.^.^.^.....^.^.....^...^.....^.^.^.^...^.^.^.^.^.^.^...^.^.^.^.^.^.^.^...^...^.^.^...^.^.....
.............................................................................................................................................
....^.^.^.....^.^...^.^...^.^.......^...^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^.^.^.^.^.....^.^...^...^.^.^.^.^.^.^....
.............................................................................................................................................
...^.^.......^.^.....^.^.^.^.^...^.^...^.^.^.^.^.^.^.^.^.^.^...^...^.^.^.^.^.....^.^.^...^.^.^...^...^.^.^...^...^.^.^.^...^.^...^.^...^.^...
.............................................................................................................................................
..^.....^.^.^...^.........^.....^...^.^.^...^.^.....^...^.^.^.^.^.^...^.........^...^.^...^...^.^...^...^.......^.^.....^.^.......^.^.^...^..
.............................................................................................................................................
.^.^...^.....^.^.^.^...^.^.....^.^.^.^.^.^.^.^...^...^.^.......^.^...^.^.....^.^.^...^.....^.^.^.^.^.^.......^.^.^...^.^.^.^.^...^...^.^.^.^.
.............................................................................................................................................";
}
